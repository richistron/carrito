"use strict";angular.module("carritoApp",["ngResource","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"CheckoutCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("carritoApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("carritoApp").controller("NavCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}]),angular.module("carritoApp").directive("productGrid",function(){return{templateUrl:"views/product-grid.html",restrict:"E"}}),angular.module("carritoApp").factory("ProductsFactory",["BaseCollection",function(a){var b=[{id:1,name:"MacBook Pro 15 inches",price:21500.3,description:"Retina display, 8 GB RAM.",onCart:0,stock:1},{id:2,name:"MacBook Pro 15 inches",price:28500.3,description:"Retina display, 16 GB RAM.",stock:2},{id:3,name:"MacBook Air 13 inches",price:1500.2,description:"Retina display, 16 GB RAM.",onCart:0,stock:15},{id:4,name:"MacBook Air 13 inches",price:1000.5,description:"Retina display, 8 GB RAM.",onCart:0,stock:15},{id:5,name:"Mouse path",price:100,description:"Magic apple path",onCart:0,stock:300}],c=function(a){function c(){this.storageId="product-items";var a=JSON.parse(localStorage.getItem(this.storageId))||b;this.setup(a)}return c.prototype=Object.create(a),c}(a.prototype);return c}]),angular.module("carritoApp").directive("carritoWidget",function(){return{templateUrl:"views/carrito-widget.html",restrict:"E"}}),angular.module("carritoApp").controller("CheckoutCtrl",["$scope","ItemsOnCart","ProductsFactory",function(a,b,c){a.isAvailable=function(a){return a.stock>0},a.isOnCart=function(b){return a.itemsOnCart.find(b.id)?!0:!1},a.addToCart=function(b){var c=a.itemsOnCart.find(b.id);c?a.itemsOnCart.replace({id:b.id,cart:c.cart+1}):a.itemsOnCart.add({id:b.id,cart:1}),a.products.merge({id:b.id,stock:b.stock-1}),a.itemsOnCart.save(),a.products.save()},a.removeFromCart=function(b){var c=a.itemsOnCart.find(b.id);if(!c)throw new Error("product not found");c.cart-1===0?a.itemsOnCart.remove(b.id):a.itemsOnCart.merge({id:b.id,cart:c.cart-1}),a.products.merge({id:b.id,stock:b.stock+1}),a.itemsOnCart.save(),a.products.save()},a.totalItems=function(){var b=0,c=a.itemsOnCart.getAll();return c.forEach(function(a){b+=a.cart}),b},a.getTotal=function(){var b=0,c=a.itemsOnCart.getAll();return c.forEach(function(c){b+=c.cart*a.products.find(c.id).price}),b},a.products=new c,a.itemsOnCart=new b}]),angular.module("carritoApp").factory("ItemsOnCart",["BaseCollection",function(a){var b=function(a){function b(a){this.storageId="checkout-items",this.load(a)}return b.prototype=Object.create(a),b}(a.prototype);return b}]),angular.module("carritoApp").factory("BaseCollection",function(){var a=function(){function a(a){this.setup(a)}return a.prototype.setup=function(a){if(!Array.isArray(a)||0===a.length)throw new Error("collection must be an array");this.attributes={},a.forEach(function(a){return function(b){if(!b.id)throw new Error("all items should contain and id");if(a.attributes[a.getPrefix(b.id)])throw new Error("duplicated id");a.attributes[a.getPrefix(b.id)]=b}}(this))},a.prototype.getPrefix=function(a){if(isNaN(a))throw new Error("id is not a number");return"item-"+a},a.prototype.find=function(a){return this.attributes[this.getPrefix(a)]||!1},a.prototype.replace=function(a){var b=this.find(a.id);if(!b)throw new Error("object does not exists");this.attributes[this.getPrefix(a.id)]=a},a.prototype.merge=function(a){var b=this.find(a.id);if(!b)throw new Error("object does not exists");this.attributes[this.getPrefix(a.id)]=_.merge(b,a)},a.prototype.getAll=function(){var a=[];for(var b in this.attributes)a.push(this.attributes[b]);return a},a.prototype.reset=function(a){if(!this.validateCollection(a))throw new Error("invalid collection");this.setup(a)},a.prototype.validateCollection=function(a){var b=!1,c=[];return Array.isArray(a)&&0!==a.length||(b=!0),a.forEach(function(a){!a.id||c["item-"+a.id]?b=!0:c["item-"+a.id]=!0}),b?!1:!0},a.prototype.add=function(a){if(!a.id||this.find(a.id))throw new Error("Duplicated or id not defined");return this.attributes[this.getPrefix(a.id)]=a,this},a.prototype.remove=function(a){return this.attributes[this.getPrefix(a)]?(delete this.attributes[this.getPrefix(a)],!0):!1},a.prototype.load=function(a){this.attributes={};var b;b=a===!0?[]:JSON.parse(localStorage.getItem(this.storageId)||"[]"),b.forEach(function(a){return function(b){a.add(b)}}(this))},a.prototype.save=function(){localStorage.setItem(this.storageId,JSON.stringify(this.getAll()))},a}();return a});